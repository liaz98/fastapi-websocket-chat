<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FastAPI WebSocket Chat</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    #messages { border: 1px solid #ccc; height: 300px; overflow-y: scroll; padding: 10px; }
    #messages div { margin-bottom: 10px; }
    #status { margin-bottom: 10px; color: green; }
  </style>
</head>
<body>

  <h2>FastAPI Chat Client</h2>

  <label for="token">JWT Token:</label><br>
  <input type="text" id="token" style="width: 100%;"><br><br>

  <button onclick="connect()">Connect</button>

  <div id="status"></div>

  <div id="messages"></div>

  <input type="text" id="input" placeholder="Type a message..." style="width: 80%;">
  <button onclick="sendMessage()">Send</button>

  <script>
    let socket;

    function connect() {
      const token = document.getElementById('token').value;
      const wsUrl = `ws://localhost:8000/ws/chat?token=${token}`;
      socket = new WebSocket(wsUrl);

      socket.onopen = () => {
        document.getElementById('status').innerText = "✅ Connected";
      };

      socket.onmessage = (event) => {
        const msg = document.createElement('div');
        msg.innerText = event.data;
        document.getElementById('messages').appendChild(msg);
      };

      socket.onclose = () => {
        document.getElementById('status').innerText = "❌ Disconnected";
      };

      socket.onerror = (error) => {
        document.getElementById('status').innerText = "⚠️ Error";
        console.error("WebSocket error:", error);
      };
    }

    function sendMessage() {
      const input = document.getElementById('input');
      const text = input.value;
      if (socket && socket.readyState === WebSocket.OPEN) {
        socket.send(text);
        input.value = '';
      }
    }
  </script>

</body>
</html>